{% comment %}
  Renders product recommendations based on cart items

  Usage:
  {% render 'cart-recommendations', limit: 4, heading: 'You might also like' %}

  Accepts:
  - limit: {Number} Number of recommendations to show (default: 4, max: 10)
  - heading: {String} Section heading text
  - intent: {String} Recommendation intent - 'related' or 'complementary' (default: 'related')
{% endcomment %}

{%- liquid
  assign limit = limit | default: 4 | at_most: 10
  assign heading = heading | default: 'You might also like'
  assign intent = intent | default: 'related'

  # Only show recommendations if cart has items
  if cart == empty
    break
  endif

  # Get unique product IDs from cart items, prioritizing component IDs when available
  assign cart_product_ids = ''
  for item in cart.items
    if item.item_components.size > 0
      for component in item.item_components
        assign cart_product_ids = cart_product_ids | append: component.product_id | append: ','
      endfor
    else
      assign cart_product_ids = cart_product_ids | append: item.product_id | append: ','
    endif
  endfor
  assign cart_product_ids = cart_product_ids | split: ',' | uniq | compact

  # Don't show recommendations if no valid products in cart
  if cart_product_ids.size == 0
    break
  endif
-%}

{{ 'component-cart-recommendations.css' | asset_url | stylesheet_tag }}

<cart-recommendations
  class="cart-recommendations"
  data-limit="{{ limit }}"
  data-intent="{{ intent }}"
  data-product-ids="{{ cart_product_ids | join: ',' }}"
  data-icon-arrow-url="{{ 'icon-arrow.svg' | asset_url }}"
  data-section-id="cart-recommendations"
>
  <div class="cart-recommendations__container">
    <h3 class="cart-recommendations__heading h4" hidden>{{ heading }}</h3>

    <div class="cart-recommendations__loading">
      {%- render 'loading-spinner' -%}
    </div>

    <div class="cart-recommendations__content" hidden>
      <!-- Recommendations will be loaded here via JavaScript -->
    </div>

    <div class="cart-recommendations__error" hidden>
      <p class="cart-recommendations__error-text">Unable to load recommendations</p>
    </div>
  </div>
</cart-recommendations>
